<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Product</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Add Product</h1>
    <section id="add-product">
        <form id="add-product-form">
            <label for="pid">PID:</label>
            <input type="text" id="pid" name="pid" required>
            <label for="product-name">Product Name:</label>
            <input type="text" id="product-name" name="product-name" required>
            <label for="packet-size">Packet Size:</label>
            <input type="text" id="packet-size" name="packet-size" required>
            <button type="submit">Save Product</button>
        </form>
        <div id="add-product-message"></div>
    </section>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script>
        let productList = [];

        async function loadExcel() {
            const response = await fetch('products.xlsx');
            const arrayBuffer = await response.arrayBuffer();
            const data = new Uint8Array(arrayBuffer);
            const workbook = XLSX.read(data, { type: 'array' });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            productList = XLSX.utils.sheet_to_json(sheet);
        }

        document.getElementById('add-product-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const pid = document.getElementById('pid').value;
            const productName = document.getElementById('product-name').value;
            const packetSize = document.getElementById('packet-size').value;

            if (productList.some(product => product.PID === pid)) {
                document.getElementById('add-product-message').innerText = 'PID already exists';
                return;
            }

            productList.push({ PID: pid, 'Product Name': productName, 'Packet Size': packetSize });
            updateExcel(productList);

            document.getElementById('add-product-message').innerText = 'Product added successfully';
            alert('Product added successfully');
            window.location.href = 'index.html';
        });

        function updateExcel(productList) {
            const newSheet = XLSX.utils.json_to_sheet(productList);
            const newWorkbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(newWorkbook, newSheet, "Sheet1");
            const wbout = XLSX.write(newWorkbook, { bookType: 'xlsx', type: 'array' });

            const blob = new Blob([wbout], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'products.xlsx';
            a.click();
            URL.revokeObjectURL(url);
        }

        window.onload = loadExcel;
    </script>
</body>
</html>
